<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POSP Payout Checker ‚Äì Srinithi Insurance Corporation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #e3f2fd; /* Light blue background */
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .main-title {
            text-align: center;
            color: #1976d2; /* Blue color */
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 20px;
            border-bottom: 1px solid #e3f2fd; /* Light blue border */
            padding-bottom: 10px;
        }
        .section-title {
            color: #1976d2; /* Blue */
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #424242; /* Dark gray */
        }
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #1976d2; /* Blue border */
            border-radius: 4px;
            box-sizing: border-box;
        }
        .rto-code {
            display: flex;
            align-items: center;
        }
        .rto-prefix {
            padding: 8px;
            border: 1px solid #1976d2; /* Blue border */
            border-radius: 4px 0 0 4px;
            background-color: #e3f2fd; /* Light blue */
            width: 50px;
            text-align: center;
            font-weight: bold;
            color: #1976d2; /* Blue text */
        }
        .rto-number {
            padding: 8px;
            border: 1px solid #1976d2; /* Blue border */
            border-left: none;
            border-radius: 0 4px 4px 0;
            flex: 1;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #1976d2; /* Blue */
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1565c0; /* Darker blue */
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="/static/logo/dark-logo-min.png" alt="Srinithi Insurance Corporation Logo" style="display: block; margin: 0 auto 20px; max-width: 200px; height: auto;">
        <div class="main-title">POSP Payout Checker:</div>
        
        <form action="/check-payout" method="post">
        <div class="section">
            <div class="section-title">Location:</div>
            <div class="form-group">
                <label for="state">State:</label>
                <select id="state" name="state">
                    <option value="" selected>-- Choose State --</option>
                    <option value="TN">Tamil Nadu</option>
                    <option value="PY">Puducherry (Pondicherry)</option>
                    <option value="TN_PONDICHERRY">Tamil Nadu - Pondicherry ID</option>
                    <option value="TN_CHENNAI">Tamil Nadu - Chennai ID</option>
                    <option value="KA">Karnataka</option>
                    <option value="KL">Kerala</option>
                    <option value="AP">Andhra Pradesh</option>
                    <option value="TS">Telangana</option>
                    <option value="MH">Maharashtra</option>

                </select>
            </div>
            <div class="form-group">
                <label>RTO Code:</label>
                <div class="rto-code">
                    <span id="rto-prefix" class="rto-prefix">XX</span>
                    <select id="rto-number" name="rto_number" class="rto-number">
                    </select>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Vehicle Classification:</div>
            <div class="form-group">
                <label for="vehicle-category">Vehicle Category:</label>
                <select id="vehicle-category" name="vehicle_category">
                    <option value="" selected>-- Choose Vehicle Category --</option>
                    <option value="two-wheeler">Two-Wheeler</option>
                    <option value="private-car">Private Car</option>
                    <option value="gcv">GCV (Goods Carrying Vehicle)</option>
                    <option value="pcv">PCV (Passenger Carrying Vehicle)</option>
                    <option value="misc">Misc</option>
                </select>
            </div>
            <div class="form-group">
                <label for="vehicle-type">Vehicle Sub-Category:</label>
                <select id="vehicle-type" name="vehicle_type">
                </select>
            </div>
            <div class="form-group" id="make-group" style="display: none;">
                <label for="make">Make:</label>
                <select id="make" name="make">
                </select>
            </div>
            <div class="form-group" id="model-group" style="display: none;">
                <label for="model">Model:</label>
                <select id="model" name="model">
                </select>
            </div>
            <div class="form-group" id="seating-group" style="display: none;">
                <label for="seating-capacity">Seating Capacity:</label>
                <select id="seating-capacity" name="seating_capacity">
                    <option value="" selected>-- Choose Seating Capacity --</option>
                    <option value="up-6">Up to 6 Seats</option>
                    <option value="7-12">7 to 12 Seats</option>
                    <option value="13-17">13 to 17 Seats</option>
                    <option value="above-17">Above 17 Seats</option>
                </select>
            </div>
            <div class="form-group">
                <label for="fuel-type">Fuel Type:</label>
                <select id="fuel-type" name="fuel_type">
                    <option value="" selected>-- Choose Fuel Type --</option>
                </select>
            </div>
            <div class="form-group" id="cc-group" style="display: none;">
                <label for="cc-slab">CC Slab:</label>
                <select id="cc-slab" name="cc_slab">
                    <option value="" selected>-- Choose CC Slab --</option>
                    <option value="upto-150">Up to 150 CC</option>
                    <option value="151-350">151 to 350 CC</option>
                    <option value="above-350">Above 350 CC</option>
                </select>
            </div>
            <div class="form-group" id="gvw-group" style="display: none;">
                <label for="gvw-slab">GVW Slab:</label>
                <select id="gvw-slab" name="gvw_slab">
                    <option value="" selected>-- Choose GVW Slab --</option>
                    <option value="upto-7500">Up to 7500 kg</option>
                    <option value="7501-12000">7501 to 12000 kg</option>
                    <option value="above-12000">Above 12000 kg</option>
                </select>
            </div>
            <div class="form-group" id="watt-group" style="display: none;">
                <label for="watt-slab">Watt Slab:</label>
                <select id="watt-slab" name="watt_slab">
                    <option value="" selected>-- Choose Watt Slab --</option>
                    <option value="upto-250">Up to 250 W</option>
                    <option value="above-250">Above 250 W</option>
                </select>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Vehicle Age:</div>
            <div class="form-group">
                <label for="vehicle-age"><strong>Age</strong></label>
                <select id="vehicle-age" name="vehicle_age">
                    <option value="">-- Choose Vehicle Age --</option>
                    <option value="upto 5 years">Up to 5 Years</option>
                    <option value="1 to 6 years">1 to 6 Years</option>
                    <option value="6 to 15 years">6 to 15 Years</option>
                    <option value="upto 15 years">Up to 15 Years</option>
                    <option value="Above 10 years">Above 10 Years</option>
                    <option value="Above 15 years">Above 15 Years</option>
                    <option value="6 to 25 years">6 to 25 Years</option>
                </select>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Policy Details:</div>
            <div class="form-group">
                <label for="policy-type">Policy Type:</label>
                <select id="policy-type" name="policy_type">
                    <option value="">-- Choose Policy Type --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="business-type">Business Type:</label>
                <select id="business-type" name="business_type">
                    <option value="">-- Choose Business Type --</option>
                    <option value="old">Old</option>
                    <option value="new">New</option>
                    <option value="rollover">Rollover</option>
                    <option value="renewal">Renewal</option>
                </select>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">NCB (No Claim Bonus):</div>
            <div class="form-group">
                <label for="ncb-slab">NCB Applicable:</label>
                <select id="ncb-slab" name="ncb_slab">
                    <option value="">-- Choose --</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Covers & Flags:</div>
            <div class="form-group">
                <label for="cpa-cover">CPA Cover:</label>
                <select id="cpa-cover" name="cpa_cover">
                    <option value="">-- Choose --</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="zero-dep">Zero Depreciation:</label>
                <select id="zero-dep" name="zero_dep">
                    <option value="">-- Choose --</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="form-group" id="trailer-group" style="display: none;">
                <label for="trailer">Trailer Attached:</label>
                <select id="trailer" name="trailer">
                    <option value="">-- Choose --</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
        </div>
        <button type="submit">Calculate Payout</button>
        </form>

        <!-- Results Section -->
        <div id="results-section" style="display: none; margin-top: 30px;">
            <div class="section">
                <div class="section-title">üìã Query Criteria</div>
                <div id="criteria-summary" style="margin: 15px 0; padding: 15px; background-color: #f5f5f5; border-left: 4px solid #2196f3; border-radius: 4px; font-size: 0.95em;">
                </div>
            </div>
            <div class="section">
                <div class="section-title">üèÜ Top Insurers with Payout</div>
                <div id="results-message" style="margin: 15px 0; padding: 10px; background-color: #e8f5e9; border-left: 4px solid #4caf50; color: #2e7d32;"></div>
                <table id="results-table" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background-color: #1976d2; color: white;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Rank</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Insurance Company & Conditions</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Payout (rp)</th>
                        </tr>
                    </thead>
                    <tbody id="results-body">
                    </tbody>
                </table>
            </div>
        </div>

    <script>
        // ==================== UTILITY FUNCTIONS ====================
        
        async function fetchAPI(url) {
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error('API fetch error:', error);
                return null;
            }
        }

        function createOption(value, label) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = label;
            return option;
        }

        function clearSelect(select) {
            select.innerHTML = '';
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '-- Choose --';
            select.appendChild(defaultOption);
        }

        // ==================== DATABASE DROPDOWN INITIALIZATION ====================
        
        let formElements = {};

        async function initializeDropdowns() {
            // Get all form elements
            formElements = {
                state: document.getElementById('state'),
                rtoNumber: document.getElementById('rto-number'),
                vehicleCategory: document.getElementById('vehicle-category'),
                vehicleType: document.getElementById('vehicle-type'),
                fuelType: document.getElementById('fuel-type'),
                policyType: document.getElementById('policy-type'),
                businessType: document.getElementById('business-type'),
                vehicleAge: document.getElementById('vehicle-age'),
                ccSlab: document.getElementById('cc-slab'),
                gvwSlab: document.getElementById('gvw-slab'),
                wattSlab: document.getElementById('watt-slab'),
                seatingCapacity: document.getElementById('seating-capacity'),
                ncbSlab: document.getElementById('ncb-slab'),
                cpaCover: document.getElementById('cpa-cover'),
                zeroDep: document.getElementById('zero-dep'),
                trailer: document.getElementById('trailer'),
                make: document.getElementById('make'),
                model: document.getElementById('model')
            };

            // Fetch and populate States
            const statesData = await fetchAPI('/api/states');
            if (statesData && statesData.states) {
                statesData.states.forEach(state => {
                    formElements.state.appendChild(createOption(state, state));
                });
            }

            // Fetch and populate Policy Types
            const policyData = await fetchAPI('/api/policy-types');
            if (policyData && policyData.policies) {
                policyData.policies.forEach(policy => {
                    formElements.policyType.appendChild(createOption(policy, policy));
                });
            }

            // Fetch and populate Business Types (excluding 'All')
            const businessData = await fetchAPI('/api/business-types');
            if (businessData && businessData.business_types) {
                businessData.business_types.forEach(business => {
                    formElements.businessType.appendChild(createOption(business, business));
                });
            }

            // Fetch and populate Vehicle Ages (excluding 'All')
            const ageData = await fetchAPI('/api/vehicle-ages');
            if (ageData && ageData.ages) {
                ageData.ages.forEach(age => {
                    formElements.vehicleAge.appendChild(createOption(age, age));
                });
            }

            // Fetch and populate Vehicle Categories
            const categoryData = await fetchAPI('/api/vehicle-categories');
            if (categoryData && categoryData.categories) {
                categoryData.categories.forEach(category => {
                    formElements.vehicleCategory.appendChild(createOption(category, category));
                });
            }

            // Fetch and populate NCB Slabs
            const ncbData = await fetchAPI('/api/ncb-slabs');
            if (ncbData && ncbData.ncb_slabs) {
                ncbData.ncb_slabs.forEach(ncb => {
                    formElements.ncbSlab.appendChild(createOption(ncb, ncb));
                });
            }

            // Fetch and populate CPA Covers
            const cpaData = await fetchAPI('/api/cpa-covers');
            if (cpaData && cpaData.cpa_covers) {
                cpaData.cpa_covers.forEach(cpa => {
                    formElements.cpaCover.appendChild(createOption(cpa, cpa));
                });
            }

            // Fetch and populate Zero Depreciation
            const zeroDepData = await fetchAPI('/api/zero-depreciation');
            if (zeroDepData && zeroDepData.options) {
                zeroDepData.options.forEach(option => {
                    formElements.zeroDep.appendChild(createOption(option, option));
                });
            }

            // Add event listeners for dependent dropdowns
            formElements.state.addEventListener('change', onStateChange);
            formElements.vehicleCategory.addEventListener('change', onVehicleCategoryChange);
            formElements.vehicleType.addEventListener('change', onVehicleTypeChange);
            formElements.fuelType.addEventListener('change', onFuelTypeChange);
        }

        // ==================== EVENT HANDLERS FOR DEPENDENT DROPDOWNS ====================
        
        async function onStateChange() {
            const state = formElements.state.value;
            
            if (!state) {
                clearSelect(formElements.rtoNumber);
                return;
            }

            // Fetch RTOs for selected state
            const rtoData = await fetchAPI(`/api/rtos/${state}`);
            clearSelect(formElements.rtoNumber);
            
            if (rtoData && rtoData.rtos) {
                rtoData.rtos.forEach(rto => {
                    formElements.rtoNumber.appendChild(createOption(rto, rto));
                });
            }
        }

        async function onVehicleCategoryChange() {
            const category = formElements.vehicleCategory.value;
            
            if (!category) {
                clearSelect(formElements.vehicleType);
                return;
            }

            // Fetch vehicle types for selected category
            const typeData = await fetchAPI(`/api/vehicle-types?category=${category}`);
            clearSelect(formElements.vehicleType);
            
            if (typeData && typeData.types) {
                typeData.types.forEach(type => {
                    formElements.vehicleType.appendChild(createOption(type, type));
                });
            }

            // Hide optional groups until vehicle type is selected
            document.getElementById('make-group').style.display = 'none';
            document.getElementById('model-group').style.display = 'none';
            document.getElementById('cc-group').style.display = 'none';
            document.getElementById('gvw-group').style.display = 'none';
            document.getElementById('watt-group').style.display = 'none';
            document.getElementById('seating-group').style.display = 'none';
            document.getElementById('trailer-group').style.display = 'none';
        }

        async function onVehicleTypeChange() {
            const vehicleType = formElements.vehicleType.value;
            const category = formElements.vehicleCategory.value;
            
            if (!vehicleType) {
                document.getElementById('make-group').style.display = 'none';
                document.getElementById('model-group').style.display = 'none';
                clearSelect(formElements.fuelType);
                clearSelect(formElements.make);
                return;
            }

            // Fetch fuel types for selected vehicle type
            const fuelData = await fetchAPI(`/api/fuel-types?vehicle_type=${vehicleType}`);
            clearSelect(formElements.fuelType);
            
            if (fuelData && fuelData.fuels) {
                fuelData.fuels.forEach(fuel => {
                    formElements.fuelType.appendChild(createOption(fuel, fuel));
                });
            }

            // Fetch makes for selected vehicle type
            const makeData = await fetchAPI(`/api/makes?vehicle_type=${vehicleType}`);
            clearSelect(formElements.make);
            
            if (makeData && makeData.makes && makeData.makes.length > 0) {
                document.getElementById('make-group').style.display = 'block';
                makeData.makes.forEach(make => {
                    formElements.make.appendChild(createOption(make, make));
                });
            } else {
                document.getElementById('make-group').style.display = 'none';
            }

            // Handle CC and GVW based on category
            if (category === 'two-wheeler') {
                document.getElementById('cc-group').style.display = 'block';
                // Fetch CC slabs
                const ccData = await fetchAPI('/api/cc-slabs');
                clearSelect(formElements.ccSlab);
                if (ccData && ccData.cc_slabs) {
                    ccData.cc_slabs.forEach(cc => {
                        formElements.ccSlab.appendChild(createOption(cc, cc));
                    });
                }
            } else if (category === 'gcv') {
                document.getElementById('gvw-group').style.display = 'block';
                // Fetch GVW slabs
                const gvwData = await fetchAPI('/api/gvw-slabs');
                clearSelect(formElements.gvwSlab);
                if (gvwData && gvwData.gvw_slabs) {
                    gvwData.gvw_slabs.forEach(gvw => {
                        formElements.gvwSlab.appendChild(createOption(gvw, gvw));
                    });
                }
            } else if (category === 'pcv') {
                // Show seating for non-auto PCV
                if (vehicleType !== 'auto') {
                    document.getElementById('seating-group').style.display = 'block';
                    // Fetch seating capacities
                    const seatingData = await fetchAPI('/api/seating-capacities');
                    clearSelect(formElements.seatingCapacity);
                    if (seatingData && seatingData.capacities) {
                        seatingData.capacities.forEach(seat => {
                            formElements.seatingCapacity.appendChild(createOption(seat, seat));
                        });
                    }
                }
            }

            // Show trailer only for Misc (Tractor)
            if (category === 'misc') {
                document.getElementById('trailer-group').style.display = 'block';
                // Fetch trailers
                const trailerData = await fetchAPI('/api/trailers');
                clearSelect(formElements.trailer);
                if (trailerData && trailerData.trailers) {
                    trailerData.trailers.forEach(trailer => {
                        formElements.trailer.appendChild(createOption(trailer, trailer));
                    });
                }
            } else {
                document.getElementById('trailer-group').style.display = 'none';
            }
        }

        async function onFuelTypeChange() {
            const fuel = formElements.fuelType.value;
            const category = formElements.vehicleCategory.value;

            // Show Watt ONLY for electric two-wheelers
            if (category === 'two-wheeler' && fuel === 'electric') {
                document.getElementById('watt-group').style.display = 'block';
                document.getElementById('cc-group').style.display = 'none';
                // Fetch watt slabs
                const wattData = await fetchAPI('/api/watt-slabs');
                clearSelect(formElements.wattSlab);
                if (wattData && wattData.watt_slabs) {
                    wattData.watt_slabs.forEach(watt => {
                        formElements.wattSlab.appendChild(createOption(watt, watt));
                    });
                }
            } else if (category === 'two-wheeler' && fuel !== 'electric') {
                document.getElementById('cc-group').style.display = 'block';
                document.getElementById('watt-group').style.display = 'none';
            }
        }

        // ==================== FORM SUBMISSION ====================
        
        const form = document.querySelector('form');
        const submitButton = form.querySelector('button[type="submit"]');
        const resultsSection = document.getElementById('results-section');
        const resultsMessage = document.getElementById('results-message');
        const resultsTable = document.getElementById('results-table');
        const resultsBody = document.getElementById('results-body');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Show loading state
            submitButton.disabled = true;
            submitButton.textContent = 'Calculating...';
            console.log('[FORM] Submitting form...');

            // Get form data
            const formData = new FormData(this);
            
            try {
                // Make API call
                console.log('[FORM] Calling /check-payout endpoint...');
                const response = await fetch('/check-payout', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                console.log('[FORM] Response received:', data.status);

                // Display results
                if (data.status === 'success' && data.top_3_payouts && data.top_3_payouts.length > 0) {
                    console.log(`[FORM] ‚úÖ Found ${data.top_3_payouts.length} payouts`);
                    resultsMessage.textContent = data.message;
                    resultsTable.style.display = 'block';
                    resultsBody.innerHTML = '';
                    
                    data.top_3_payouts.forEach(payout => {
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid #ddd';
                        if (payout.rank % 2 === 0) {
                            row.style.backgroundColor = '#f5f5f5';
                        }
                        
                        // Format company name with conditions if present
                        const companyDisplay = payout.conditions 
                            ? `<strong>${payout.company_name}</strong><br/><span style="font-size: 0.9em; color: #666;">üìå ${payout.conditions}</span>`
                            : `<strong>${payout.company_name}</strong>`;
                        
                        row.innerHTML = `
                            <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold; text-align: center;">
                                ${payout.rank === 1 ? 'ü•á' : payout.rank === 2 ? 'ü•à' : payout.rank === 3 ? 'ü•â' : payout.rank}
                            </td>
                            <td style="padding: 12px; border: 1px solid #ddd;">${companyDisplay}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold; color: #1976d2;">
                                ${payout.payout_percentage.toFixed(2)}rp
                            </td>
                        `;
                        resultsBody.appendChild(row);
                    });

                    resultsSection.style.display = 'block';
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    
                    // Display selected criteria summary
                    const criteriaSummary = document.getElementById('criteria-summary');
                    const formDataObj = new FormData(form);
                    const criteria = {
                        'State': formDataObj.get('state') || 'N/A',
                        'RTO Code': formDataObj.get('rto_number') || 'N/A',
                        'Vehicle Category': formDataObj.get('vehicle_category') || 'N/A',
                        'Vehicle Type': formDataObj.get('vehicle_type') || 'N/A',
                        'Fuel Type': formDataObj.get('fuel_type') || 'N/A',
                        'Vehicle Age': formDataObj.get('vehicle_age') || 'N/A',
                        'Policy Type': formDataObj.get('policy_type') || 'N/A',
                        'Business Type': formDataObj.get('business_type') || 'N/A',
                        'NCB': formDataObj.get('ncb_slab') || 'N/A',
                        'CPA Cover': formDataObj.get('cpa_cover') || 'N/A',
                        'Zero Depreciation': formDataObj.get('zero_dep') || 'N/A'
                    };
                    
                    let criteriaHTML = '<strong>‚úì Query Submitted With:</strong><br/><br/>';
                    for (const [key, value] of Object.entries(criteria)) {
                        if (value && value !== 'N/A') {
                            criteriaHTML += `<strong>${key}:</strong> ${value}<br/>`;
                        }
                    }
                    criteriaSummary.innerHTML = criteriaHTML;
                } else {
                    console.log('[FORM] ‚ö†Ô∏è No data found');
                    resultsMessage.textContent = data.message || 'No payout data found for this combination.';
                    resultsMessage.style.backgroundColor = '#fff3cd';
                    resultsMessage.style.borderLeftColor = '#ffc107';
                    resultsMessage.style.color = '#856404';
                    resultsBody.innerHTML = '';
                    resultsTable.style.display = 'none';
                    
                    // Display criteria summary even when no results
                    const criteriaSummary = document.getElementById('criteria-summary');
                    const formDataObj = new FormData(form);
                    const criteria = {
                        'State': formDataObj.get('state') || 'N/A',
                        'RTO Code': formDataObj.get('rto_number') || 'N/A',
                        'Vehicle Category': formDataObj.get('vehicle_category') || 'N/A',
                        'Vehicle Type': formDataObj.get('vehicle_type') || 'N/A',
                        'Fuel Type': formDataObj.get('fuel_type') || 'N/A',
                        'Vehicle Age': formDataObj.get('vehicle_age') || 'N/A',
                        'Policy Type': formDataObj.get('policy_type') || 'N/A',
                        'Business Type': formDataObj.get('business_type') || 'N/A',
                        'NCB': formDataObj.get('ncb_slab') || 'N/A',
                        'CPA Cover': formDataObj.get('cpa_cover') || 'N/A',
                        'Zero Depreciation': formDataObj.get('zero_dep') || 'N/A'
                    };
                    
                    let criteriaHTML = '<strong>‚úì Query Submitted With:</strong><br/><br/>';
                    for (const [key, value] of Object.entries(criteria)) {
                        if (value && value !== 'N/A') {
                            criteriaHTML += `<strong>${key}:</strong> ${value}<br/>`;
                        }
                    }
                    criteriaSummary.innerHTML = criteriaHTML;
                    
                    resultsSection.style.display = 'block';
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            } catch (error) {
                console.error('[FORM] Error:', error);
                resultsMessage.textContent = 'Error processing request: ' + error.message;
                resultsMessage.style.backgroundColor = '#ffebee';
                resultsMessage.style.borderLeftColor = '#f44336';
                resultsMessage.style.color = '#c62828';
                resultsBody.innerHTML = '';
                resultsTable.style.display = 'none';
                resultsSection.style.display = 'block';
                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } finally {
                // Reset button state
                submitButton.disabled = false;
                submitButton.textContent = 'Calculate Payout';
                console.log('[FORM] Form submission complete');
            }
        });

        // Initialize dropdowns on page load
        document.addEventListener('DOMContentLoaded', initializeDropdowns);
    </script>
            'TN': {
                '01': 'CHENNAI CENTRAL RTO',
                '02': 'CHENNAI (NORTH WEST) RTO',
                '03': 'CHENNAI (NORTH EAST) RTO',
                '04': 'CHENNAI (EAST) RTO',
                '05': 'CHENNAI (NORTH) RTO',
                '06': 'CHENNAI (SOUTH-EAST) RTO',
                '07': 'CHENNAI (SOUTH) RTO',
                '09': 'CHENNAI WEST RTO',
                '10': 'CHENNAI (SOUTH-WEST) RTO',
                '11': 'TAMBARAM RTO',
                '12': 'PARUTHIPATTU RTO',
                '13': 'AMBATTUR RTO',
                '14': 'SHOLINGANALLUR RTO',
                '15': 'ULUNDURPET RTO',
                '15M': 'KALAKURICHI RTO',
                '16': 'TINDIVANAM RTO',
                '18': 'REDHILLS RTO',
                '19': 'CHENGALPATTU RTO',
                '20': 'THIRUVALLUR RTO',
                '21': 'KANCHIPURAM RTO',
                '22': 'MEENAMBAKKAM RTO',
                '23': 'VELLORE RTO',
                '24': 'KRISHNAGIRI RTO',
                '25': 'TIRUVANNAMALAI RTO',
                '28': 'NAMAKKAL (NORTH) RTO',
                '29': 'DHARMAPURI RTO',
                '30': 'SALEM (WEST) RTO',
                '31': 'CUDDALORE RTO',
                '32': 'VILUPPURAM RTO',
                '33': 'ERODE EAST RTO',
                '34': 'TIRUCHENGODE RTO',
                '36': 'GOBI RTO',
                '37': 'COIMBATORE (SOUTH) RTO',
                '38': 'COIMBATORE NORTH RTO',
                '39': 'TIRUPUR NORTH RTO',
                '40': 'METTUPALAYAM RTO',
                '41': 'POLLACHI RTO',
                '42': 'TIRUPUR SOUTH RTO',
                '43': 'OOTY RTO',
                '45': 'TRICHY WEST RTO',
                '46': 'PERAMBALUR RTO',
                '47': 'KARUR RTO',
                '48': 'SRIRANGAM RTO',
                '49': 'THANJAVUR RTO',
                '50': 'TIRUVARUR RTO',
                '51': 'NAGAPATTINAM RTO',
                '52': 'SANKAGIRI RTO',
                '54': 'SALEM (EAST) RTO',
                '55': 'PUDUKKOTTAI RTO',
                '56': 'PERUNDURAI RTO',
                '57': 'DINDIGUL RTO',
                '58': 'MADURAI (SOUTH) RTO',
                '59': 'MADURAI (NORTH) RTO',
                '60': 'THENI RTO',
                '61': 'ARIYALUR RTO',
                '63': 'SIVAGANGAI RTO',
                '64': 'MADURAI (CENTRAL) RTO',
                '65': 'RAMANATHAPURAM RTO',
                '66': 'COIMBATORE (CENTRAL) RTO',
                '67': 'VIRUDHUNAGAR RTO',
                '68': 'KUMBAKONAM RTO',
                '69': 'TUTICORIN RTO',
                '70': 'HOSUR RTO',
                '72': 'TIRUNELVELI RTO',
                '73': 'RANIPET RTO',
                '74': 'NAGERCOIL RTO',
                '75': 'MARTHANDAM RTO',
                '76': 'TENKASI RTO',
                '77': 'ATTUR RTO',
                '78': 'DHARAPURAM RTO',
                '79': 'SANKARANKOVIL RTO',
                '81': 'TRICHY (EAST) RTO',
                '82': 'MAYILADUTHURAI RTO',
                '83': 'VANIYAMBADI RTO',
                '83M': 'TIRUPATTUR RTO',
                '84': 'SRIVILLIPUTTUR RTO',
                '85': 'KUNDRATHUR RTO',
                '86': 'ERODE WEST RTO',
                '87': 'SRIPERUMBUDUR RTO',
                '88': 'NAMAKKAL SOUTH RTO',
                '90': 'SALEM (SOUTH) RTO',
                '91': 'CHIDHAMBARAM RTO',
                '92': 'THIRUCHENDUR RTO',
                '93': 'METTUR RTO',
                '94': 'PALANI RTO',
                '95': 'SIVAKASI RTO',
                '96': 'KOVILPATTI RTO',
                '97': 'ARANI RTO',
                '99': 'COIMBATORE (WEST) RTO'
            },
            'PY': {
                '01': 'PUDUCHERRY',
                '02': 'KARAIKAL',
                '03': 'MAHE',
                '04': 'YANAM',
                '05': 'OULGARET'
            },
            'KA': {
                '01': 'Koramangala',
                '02': 'Rajajinagar',
                '03': 'Indiranagar',
                '04': 'Yeshwanthpur',
                '05': 'Jayanagar',
                '06': 'Tumkur',
                '07': 'Kolar',
                '08': 'Kolar Gold Fields',
                '09': 'Mysuru',
                '10': 'Chamarajanagar',
                '11': 'Mandya',
                '12': 'Madikeri',
                '13': 'Hassan',
                '14': 'Shivamogga',
                '15': 'Sagara',
                '16': 'Chitradurga',
                '17': 'Davanagere',
                '18': 'Chikkamagaluru',
                '19': 'Mangaluru',
                '20': 'Udupi',
                '21': 'Puttur',
                '22': 'Belagavi',
                '23': 'Chikkodi',
                '24': 'Bailhongal',
                '25': 'Dharwad',
                '26': 'Gadag',
                '27': 'Haveri',
                '28': 'Vijayapura',
                '29': 'Bagalkote',
                '30': 'Karwar',
                '31': 'Sirsi',
                '32': 'Kalaburagi',
                '33': 'Yadgir',
                '34': 'Ballari',
                '35': 'Hosapete',
                '36': 'Raichur',
                '37': 'Koppal',
                '38': 'Bidar',
                '39': 'Bhalki',
                '40': 'Chikkaballapura',
                '41': 'Jnana Bharathi',
                '42': 'Ramanagara',
                '43': 'Devanahalli',
                '44': 'Tiptur',
                '45': 'Hunsur',
                '46': 'Sakleshpura',
                '47': 'Honnavar',
                '48': 'Jamkhandi',
                '49': 'Gokak',
                '50': 'Yelahanka',
                '51': 'Electronic City',
                '52': 'Nelamangala',
                '53': 'KR Puram',
                '57': 'Shantinagar',
                '58': 'Chamrajpet',
                '59': 'Chandapura',
                '60': 'RT Nagar',
                '61': 'Marathahalli',
                '63': 'Dharwad East',
                '64': 'Madhugiri',
                '65': 'Dandeli',
                '66': 'Tarikere',
                '67': 'Chintamani',
                '68': 'Ranebennur',
                '69': 'Ramdurg',
                '70': 'Bantwal',
                '71': 'Athani'
            },
            'KL': {
                '01': 'Thiruvananthapuram',
                '02': 'Kollam',
                '03': 'Pathanamthitta',
                '04': 'Alappuzha',
                '05': 'Kottayam',
                '06': 'Idukki',
                '07': 'Ernakulam',
                '08': 'Thrissur',
                '09': 'Palakkad',
                '10': 'Malappuram',
                '11': 'Kozhikode',
                '12': 'Wayanad',
                '13': 'Kannur',
                '14': 'Kasargode',
                '15': 'Kerala',
                '16': 'Attingal',
                '17': 'Muvattupuzha',
                '18': 'Vadakara',
                '19': 'Parassala',
                '20': 'Neyyattinkara',
                '21': 'Nedumangad',
                '22': 'Kazhakkoottam',
                '23': 'Karunagapally',
                '24': 'Kottarakara',
                '25': 'Punalur',
                '26': 'Adoor',
                '28': 'Mallappally',
                '29': 'Kayamkulam',
                '30': 'Chengannur',
                '31': 'Mavelikara',
                '32': 'Cherthala',
                '33': 'Changanassery',
                '34': 'Kanjirappally',
                '35': 'Pala',
                '36': 'Vaikom',
                '37': 'Vandiperiyar',
                '38': 'Thodupuzha',
                '39': 'Thripunithura',
                '40': 'Perumbavoor',
                '41': 'Aluva',
                '42': 'North Paravur',
                '43': 'Mattancherry',
                '44': 'Kothamangalam',
                '45': 'Irinjalakuda',
                '46': 'Guruvayur',
                '47': 'Kodungallur',
                '48': 'Wadakkancherry',
                '49': 'Alathur',
                '50': 'Mannarghat',
                '51': 'Ottappalam',
                '52': 'Pattambi',
                '53': 'Perinthalmanna',
                '54': 'Ponnani',
                '55': 'Tirur',
                '56': 'Koyilandi',
                '57': 'Koduvally',
                '58': 'Thalassery',
                '59': 'Thaliparamba',
                '60': 'Kanhangad',
                '61': 'Kunnathur',
                '62': 'Ranni',
                '63': 'Angamaly',
                '64': 'Chalakkudy',
                '65': 'Thirurangadi',
                '66': 'Kuttanadu',
                '67': 'Uzhavoor',
                '68': 'Devikulam',
                '69': 'Udumbanchola',
                '70': 'Chittur',
                '71': 'Nilambur',
                '72': 'Mananthavady',
                '73': 'Sulthan Bathery'
            },
            'AP': {
                '01': 'Adilabad',
                '02': 'Anantapur',
                '03': 'Chittoor',
                '04': 'Kadapa',
                '05': 'Kakinada',
                '06': 'Kakinada',
                '07': 'Guntur',
                '08': 'Guntur',
                '09': 'Hyderabad Central',
                '10': 'Hyderabad North',
                '11': 'Hyderabad East',
                '12': 'Hyderabad South',
                '13': 'Hyderabad West',
                '14': 'Hyderabad',
                '15': 'Karimnagar',
                '16': 'Vijayawada',
                '17': 'Vijayawada',
                '18': 'Vijayawada',
                '19': 'Vijayawada',
                '20': 'Khammam',
                '21': 'Kurnool',
                '22': 'Mahbubnagar',
                '23': 'Medak',
                '24': 'Nalgonda',
                '25': 'Nizamabad',
                '26': 'Nellore',
                '27': 'Ongole',
                '28': 'Ranga Reddy',
                '29': 'Ranga Reddy',
                '30': 'Srikakulam',
                '31': 'Visakhapatnam',
                '32': 'Visakhapatnam',
                '33': 'Gajuwaka',
                '35': 'Vizianagaram',
                '36': 'Warangal',
                '37': 'Eluru'
            },
            'MH': {
                '01': 'Mumbai (South) - Tardeo',
                '02': 'Mumbai (West) - Andheri',
                '03': 'Mumbai (East) - Ghatkopar',
                '04': 'Thane',
                '05': 'Kalyan',
                '06': 'Raigad',
                '07': 'Sindhudurg Nagari',
                '08': 'Ratnagiri',
                '09': 'Kolhapur',
                '10': 'Sangli',
                '11': 'Satara',
                '12': 'Pune',
                '13': 'Solapur',
                '14': 'Pimpri Chinchwad',
                '16': 'Ahmednagar',
                '17': 'Shrirampur - Ahmednagar',
                '18': 'Dhule',
                '19': 'Jalgaon',
                '20': 'Aurangabad',
                '21': 'Jalna',
                '22': 'Parbhani',
                '23': 'Beed',
                '24': 'Latur',
                '25': 'Osmanabad',
                '26': 'Nanded',
                '27': 'Amravati',
                '28': 'Buldana',
                '29': 'Yavatmal',
                '30': 'Akola',
                '31': 'Nagpur',
                '33': 'Gadchiroli',
                '34': 'Chandrapur',
                '35': 'Gondia',
                '36': 'Bhandara',
                '37': 'Washim',
                '38': 'Hingoli',
                '39': 'Nandurbar',
                '40': 'Wadi Nagpur',
                '41': 'Malegaon - Nashik District',
                '42': 'Baramati - Pune',
                '43': 'Vashi (Sanpada)',
                '44': 'Ambejogai Beed',
                '45': 'Akluj - Solapur',
                '46': 'Panvel',
                '47': 'Borivali',
                '48': 'Vasai - Virar',
                '49': 'Nagpur (East) - Bhandara Road',
                '50': 'Karad',
                '51': 'Sangamner - Ahmednagar',
                '52': 'Parbhani (Rural)',
                '53': 'Pune South',
                '54': 'Pune North',
                '55': 'Mumbai Central',
                '56': 'Thane Rural'
            },
            'TS': {
                '01': 'Adilabad',
                '02': 'Karimnagar',
                '03': 'Warangal',
                '04': 'Khammam',
                '05': 'Nalgonda',
                '06': 'Mahbubnagar',
                '07': 'Ranga Reddy',
                '08': 'Ranga Reddy',
                '09': 'Hyderabad Central',
                '10': 'Hyderabad North',
                '11': 'Hyderabad East',
                '12': 'Hyderabad South',
                '13': 'Hyderabad West',
                '14': 'Hyderabad',
                '15': 'Medak',
                '16': 'Nizamabad'
            }
        };

        // Map TN_PONDICHERRY and TN_CHENNAI to use the full Tamil Nadu RTO list
        rtoData['TN_PONDICHERRY'] = rtoData['TN'];
        rtoData['TN_CHENNAI'] = rtoData['TN']                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ;

        // Age Slabs based on Vehicle Category and Sub-Category (from reference data)
        // NOTE: Age is now a numeric input (1-50), ranges will be matched on backend
        const ageSlabs = {
            'bike': [],
            'scooter': [],
            'private-car': [],
            'auto': [],
            'taxi': [],
            'educational-bus': [],
            'staff-bus': [],
            '3-wheeler-goods': [],
            '4-wheeler-goods': [],
            'flatbed': [],
            'tractor': [],
            'other-misc-vehicles': []
        };

        const stateSelect = document.getElementById('state');
        const rtoPrefix = document.getElementById('rto-prefix');
        const rtoNumberSelect = document.getElementById('rto-number');
        const vehicleCategorySelect = document.getElementById('vehicle-category');
        const vehicleTypeSelect = document.getElementById('vehicle-type');
        const vehicleAgeSelect = document.getElementById('vehicle-age');
        const fuelTypeSelect = document.getElementById('fuel-type');
        const ccGroup = document.getElementById('cc-group');
        const gvwGroup = document.getElementById('gvw-group');
        const wattGroup = document.getElementById('watt-group');
        const seatingGroup = document.getElementById('seating-group');
        const trailerGroup = document.getElementById('trailer-group');
        const makeGroup = document.getElementById('make-group');
        const modelGroup = document.getElementById('model-group');
        const makeSelect = document.getElementById('make');
        const modelSelect = document.getElementById('model');
        const policyTypeSelect = document.getElementById('policy-type');
        const ncbSlabSelect = document.getElementById('ncb-slab');
        const ccSlabSelect = document.getElementById('cc-slab');
        const seatingCapacitySelect = document.getElementById('seating-capacity');

        // Make/Model data by vehicle type
        const makeModelData = {
            '4-wheeler-goods': {
                makes: ['TATA', 'Mahindra,Ashok', 'Other make', 'All make'],
                models: ['except Bolero']
            },
            'flatbed': {
                makes: [],
                models: []
            },
            '3-wheeler-goods': {
                makes: [],
                models: []
            },
            'taxi': {
                makes: [],
                models: ['Innova, Innova crysta, Hycross, Scorpio, Bolero']
            },
            'auto': {
                makes: ['Bajaj,Piaggio', 'Piaggio'],
                models: []
            },
            'bike': {
                makes: ['Hero,Yamaha', 'TVS', 'Suzuhi', 'RE', 'Honda'],
                models: []
            },
            'scooter': {
                makes: ['TVS', 'Except TVS', 'Except Hero'],
                models: []
            },
            'educational-bus': {
                makes: [],
                models: []
            },
            'staff-bus': {
                makes: [],
                models: []
            },
            'tractor': {
                makes: [],
                models: []
            },
            'other-misc-vehicles': {
                makes: [],
                models: []
            },
            'private-car': {
                makes: [],
                models: []
            }
        };

        // Function to update policy types based on vehicle category
        function updatePolicyTypes(category) {
            policyTypeSelect.innerHTML = '<option value="">-- Choose Policy Type --</option>';
            let policyOptions = [];
            
            if (category === 'two-wheeler' || category === 'private-car') {
                policyOptions = ['Comprehensive (1+1)', 'SATP', 'Bundle (1+5)', 'SAOD'];
            } else if (category === 'gcv') {
                policyOptions = ['Comprehensive (1+1)', 'SATP'];
            } else if (category === 'pcv' || category === 'misc') {
                policyOptions = ['Comprehensive (1+1)', 'SATP'];
            } else {
                policyOptions = ['Comprehensive (1+1)', 'SATP'];
            }
            
            policyOptions.forEach(policy => {
                const option = document.createElement('option');
                option.value = policy.toLowerCase().replace(/\s+/g, '-').replace(/[()]/g, '');
                option.textContent = policy;
                policyTypeSelect.appendChild(option);
            });
        }

        // RTO prefix update and populate RTO names
        stateSelect.addEventListener('change', function() {
            const selectedState = this.value;
            if (selectedState) {
                rtoPrefix.textContent = selectedState;
                
                // Populate RTO numbers with names - sorted in ascending order
                rtoNumberSelect.innerHTML = '';
                const placeholder = document.createElement('option');
                placeholder.value = '';
                placeholder.textContent = '-- Choose RTO Code --';
                placeholder.selected = true;
                rtoNumberSelect.appendChild(placeholder);
                
                const rtos = rtoData[selectedState];
                
                if (rtos) {
                    // Sort RTO codes in ascending order (numeric sorting with special handling)
                    const sortedCodes = Object.keys(rtos).sort((a, b) => {
                        const numA = parseInt(a);
                        const numB = parseInt(b);
                        if (numA !== numB) {
                            return numA - numB;  // Sort by numeric value
                        }
                        // If numeric parts are equal, sort alphabetically (e.g., '15' before '15M')
                        return a.localeCompare(b);
                    });
                    
                    for (const code of sortedCodes) {
                        const name = rtos[code];
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = `${code} - ${name}`;
                        rtoNumberSelect.appendChild(option);
                    }
                }
                rtoNumberSelect.selectedIndex = 0;
                rtoNumberSelect.value = '';
                rtoNumberSelect.options[0].selected = true;
            } else {
                rtoPrefix.textContent = 'XX';
                rtoNumberSelect.innerHTML = '';
                const placeholder = document.createElement('option');
                placeholder.value = '';
                placeholder.textContent = '-- Choose RTO Code --';
                rtoNumberSelect.appendChild(placeholder);
            }
        });

        // Vehicle Category change event
        vehicleCategorySelect.addEventListener('change', function() {
            const category = this.value;
            vehicleTypeSelect.innerHTML = '';
            const defaultType = document.createElement('option');
            defaultType.value = '';
            defaultType.textContent = '-- Choose Vehicle Sub-Category --';
            vehicleTypeSelect.appendChild(defaultType);
            let options = [];
            if (category === 'two-wheeler') {
                options = ['Bike', 'Scooter'];
            } else if (category === 'private-car') {
                options = ['Private Car'];
            } else if (category === 'gcv') {
                options = ['3 Wheeler Goods', '4 Wheeler Goods'];
            } else if (category === 'flatbed') {
                // Flatbed is a top-level category; its sub-types (if any) are specific to flatbed
                options = ['Flatbed'];
            } else if (category === 'pcv') {
                options = ['Auto', 'Taxi', 'Educational Bus', 'Staff Bus'];
            } else if (category === 'misc') {
                options = ['Tractor', 'Other Misc Vehicles'];
            }
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.replace(/\s+/g, '-').toLowerCase();
                option.textContent = opt;
                vehicleTypeSelect.appendChild(option);
            });

            // Update Fuel Type based on Category
            fuelTypeSelect.innerHTML = '';
            const defaultFuel = document.createElement('option');
            defaultFuel.value = '';
            defaultFuel.textContent = '-- Choose Fuel Type --';
            fuelTypeSelect.appendChild(defaultFuel);
            let fuelOptions = [];
            if (category === 'two-wheeler') {
                fuelOptions = ['Petrol', 'Electric'];
            } else if (category === 'flatbed') {
                // Flatbeds are diesel operated in our dataset
                fuelOptions = ['Diesel'];
            } else if (category === 'misc') {
                fuelOptions = ['Petrol', 'Diesel'];
            } else {
                fuelOptions = ['Petrol', 'Diesel', 'CNG', 'Electric'];
            }
            fuelOptions.forEach(fuel => {
                const option = document.createElement('option');
                option.value = fuel.toLowerCase();
                option.textContent = fuel;
                fuelTypeSelect.appendChild(option);
            });

            // Update CC / GVW based on Category
            ccSlabSelect.innerHTML = '';
            const defaultCC = document.createElement('option');
            defaultCC.value = '';
            defaultCC.textContent = '-- Choose CC Slab --';
            ccSlabSelect.appendChild(defaultCC);
            let ccOptions = [];
            if (category === 'two-wheeler') {
                ccOptions = ['Up to 150 CC', '151 to 350 CC', 'Above 350 CC'];
            } else if (category === 'private-car') {
                ccOptions = ['Up to 1500 CC', '1501 to 2500 CC', 'Above 2500 CC'];
            }
            ccOptions.forEach(cc => {
                const option = document.createElement('option');
                option.value = cc.toLowerCase().replace(/\s+/g, '-').replace(/cc/g, '').replace(/to/g, '-to-');
                option.textContent = cc;
                ccSlabSelect.appendChild(option);
            });

            // Show/Hide fields based on category
            ccGroup.style.display = (category === 'two-wheeler' || category === 'private-car') ? 'block' : 'none';
            // Flatbed behaves like a GCV - show GVW options and hide unrelated fields
            gvwGroup.style.display = (category === 'gcv' || category === 'flatbed') ? 'block' : 'none';
            wattGroup.style.display = 'none'; // Will be shown based on fuel type
            seatingGroup.style.display = 'none'; // Will be shown based on vehicle type for PCV
            trailerGroup.style.display = 'none'; // Will be shown only for Tractor type
            // For Flatbed we don't require Make/Model selection in the UI
            makeGroup.style.display = (category === 'flatbed') ? 'none' : 'none';
            modelGroup.style.display = (category === 'flatbed') ? 'none' : 'none';

            // Update policy types based on category
            updatePolicyTypes(category);
        });

        // Vehicle Type change event
        vehicleTypeSelect.addEventListener('change', function() {
            const selectedType = this.value;
            const category = vehicleCategorySelect.value;
            
            if (!selectedType) {
                makeGroup.style.display = 'none';
                modelGroup.style.display = 'none';
            } else {
                // For Flatbed category we do NOT show Make/Model selection in the UI
                if (category === 'flatbed') {
                    makeGroup.style.display = 'none';
                    modelGroup.style.display = 'none';
                } else {
                    // Show Make and Model fields after vehicle type is selected
                    makeGroup.style.display = 'block';
                    modelGroup.style.display = 'block';
                    
                    // Handle Make and Model population
                    const makeModelInfo = makeModelData[selectedType];
                    
                    // Populate Make with "Others" option
                    makeSelect.innerHTML = '';
                    const defaultMake = document.createElement('option');
                    defaultMake.value = '';
                    defaultMake.textContent = '-- Choose Make --';
                    makeSelect.appendChild(defaultMake);
                    
                    // Add "Others" option first
                    const othersMakeOption = document.createElement('option');
                    othersMakeOption.value = 'others';
                    othersMakeOption.textContent = 'Others';
                    makeSelect.appendChild(othersMakeOption);
                    
                    // Add database makes if available
                    if (makeModelInfo && makeModelInfo.makes && makeModelInfo.makes.length > 0) {
                        makeModelInfo.makes.forEach(make => {
                            const option = document.createElement('option');
                            option.value = make.toLowerCase().replace(/\s+/g, '-');
                            option.textContent = make;
                            makeSelect.appendChild(option);
                        });
                    }
                    
                    // Populate Model with "Others" option
                    modelSelect.innerHTML = '';
                    const defaultModel = document.createElement('option');
                    defaultModel.value = '';
                    defaultModel.textContent = '-- Choose Model --';
                    modelSelect.appendChild(defaultModel);
                    
                    // Add "Others" option first
                    const othersModelOption = document.createElement('option');
                    othersModelOption.value = 'others';
                    othersModelOption.textContent = 'Others';
                    modelSelect.appendChild(othersModelOption);
                    
                    // Add database models if available
                    if (makeModelInfo && makeModelInfo.models && makeModelInfo.models.length > 0) {
                        makeModelInfo.models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.toLowerCase().replace(/\s+/g, '-').replace(/,/g, '-');
                            option.textContent = model;
                            modelSelect.appendChild(option);
                        });
                    }
                }
            }
            
            // Handle seating for PCV
            if (category === 'pcv') {
                if (selectedType === 'auto') {
                    seatingGroup.style.display = 'none';
                } else {
                    seatingGroup.style.display = 'block';
                    seatingCapacitySelect.innerHTML = '';
                    const defaultSeat = document.createElement('option');
                    defaultSeat.value = '';
                    defaultSeat.textContent = '-- Choose Seating Capacity --';
                    seatingCapacitySelect.appendChild(defaultSeat);
                    let seatOptions = [];
                    if (selectedType === 'taxi') {
                        seatOptions = ['Up to 6 Seats', '7 to 12 Seats'];
                    } else if (selectedType === 'educational-bus' || selectedType === 'staff-bus') {
                        seatOptions = ['Up to 12 Seats', '13 to 17 Seats', 'Above 17 Seats'];
                    }
                    seatOptions.forEach(seat => {
                        const option = document.createElement('option');
                        option.value = seat.toLowerCase().replace(/\s+/g, '-').replace(/seats/g, '');
                        option.textContent = seat;
                        seatingCapacitySelect.appendChild(option);
                    });
                }
            } else {
                seatingGroup.style.display = 'none';
            }
            
            // Show trailer only for Tractor
            trailerGroup.style.display = (selectedType === 'tractor') ? 'block' : 'none';
        });

        // Watt Slab based on Fuel Type (Electric) - hide CC for electric vehicles
        fuelTypeSelect.addEventListener('change', function() {
            const fuel = this.value;
            const category = vehicleCategorySelect.value;
            // Show Watt ONLY for electric two-wheelers
            wattGroup.style.display = (category === 'two-wheeler' && fuel === 'electric') ? 'block' : 'none';
            // Hide CC if two-wheeler with electric fuel
            if (category === 'two-wheeler' && fuel === 'electric') {
                ccGroup.style.display = 'none';
            } else if (category === 'two-wheeler' && fuel !== 'electric') {
                // Show CC for non-electric two-wheelers
                ccGroup.style.display = 'block';
            }
        });

        // NCB is now directly selected by user (Yes/No only)
        // No need for derivation based on age or claim status
    </script>
</body>
</html>